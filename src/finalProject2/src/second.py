#!/usr/bin/env python
#12/2/18
import rospy
import numpy as np
from geometry_msgs.msg import PoseArray, Pose, PoseStamped
import utils # <----------- LOOK AT THESE FUNCTIONS ***************************

PUB_TOPIC = '/world_pose_array' # The topic that you should publish to
MAP_TOPIC = 'static_map' # The service topic that will provide the map
#POSE_TOPIC = '/sim_car_pose/pose'
POSE_TOPIC = "/pf/viz/inferred_pose"

class PointMap:

  def __init__(self):
    self.pub = rospy.Publisher(PUB_TOPIC, PoseArray, queue_size=1) 
    self.viz_sub = rospy.Subscriber(POSE_TOPIC, PoseStamped, self.viz_sub, queue_size = 1)# Create a subscriber to the current position of the car


    self.plan1 = [[ 49.85113144,  12.11145401,   1.25342306], [ 49.87564152,  12.18607142,   1.30578294], [ 49.89621284,  12.26186934,   1.35814281],[ 49.91278902,  12.33863999,   1.41050269], [ 49.92532461,  12.41617296,   1.46286257], [ 49.93378525,  12.49425574,   1.51522245], [ 49.93814777,  12.5726743 ,   1.56758232], [ 49.9384002 ,  12.65121371,   1.6199422 ], [ 49.93758832,  12.6677201 ,   1.63095976], [ 49.93286595,  12.74611782,   1.57859988], [ 49.93225306,  12.82465524,   1.52624001], [ 49.93575135,  12.90311711,   1.47388013], [ 49.94335122,  12.98128836,   1.42152025], [ 49.95503184,  13.05895474,   1.36916037], [ 49.9707612 ,  13.13590336,   1.3168005 ], [ 49.99049618,  13.21192331,   1.26444062], [ 50.01418269,  13.28680623,   1.21208074], [ 50.04175581,  13.36034687,   1.15972086], [ 50.07313997,  13.43234366,   1.10736099], [ 50.10824913,  13.50259926,   1.05500111], [ 50.14698707,  13.57092111,   1.00264123], [ 50.18924761,  13.63712194,   0.95028135], [ 50.23491491,  13.70102029,   0.89792148], [ 50.28386382,  13.76244104,   0.8455616 ], [ 50.33596015,  13.82121582,   0.79320172], [ 50.39106112,  13.87718354,   0.74084184], [ 50.4490157 ,  13.93019079,   0.68848196], [ 50.50966505,  13.98009229,   0.63612209], [ 50.57284291,  14.02675127,   0.58376221], [ 50.63837614,  14.07003982,   0.53140233], [ 50.7060851 ,  14.10983931,   0.47904245], [ 50.77578422,  14.14604064,   0.42668258], [ 50.84728244,  14.17854458,   0.3743227 ], [ 50.92038381,  14.20726205,   0.32196282], [ 50.99488795,  14.23211434,   0.26960294], [ 51.07059065,  14.25303332,   0.21724307], [ 51.14728442,  14.26996166,   0.16488319], [ 51.22475904,  14.28285296,   0.11252331], [ 51.30280216,  14.29167188,   0.06016343], [  5.13811999e+01,   1.42963943e+01,   7.80355656e-03], [  5.14597373e+01,   1.42970071e+01,  -4.45563210e-02], [ 51.33819917,  14.29350885,  -0.0969162 ], [ 51.41637043,  14.28590898,  -0.14927608], [ 51.4940368 ,  14.27422836,  -0.20163595], [ 51.57098542,  14.258499  ,  -0.25399583], [ 51.64700537,  14.23876402,  -0.30635571], [ 51.7218883 ,  14.21507751,  -0.35871559], [ 51.79542894,  14.18750439,  -0.41107546], [ 51.86742573,  14.15612024,  -0.46343534], [ 51.93768133,  14.12101108,  -0.51579522], [ 52.00600317,  14.08227314,  -0.5681551 ], [ 52.072204  ,  14.0400126 ,  -0.62051497], [ 52.13610236,  13.99434529,  -0.67287485], [ 52.1975231 ,  13.94539639,  -0.72523473], [ 52.25629788,  13.89330005,  -0.77759461], [ 52.3122656 ,  13.83819908,  -0.82995448], [ 52.36527286,  13.7802445 ,  -0.88231436], [ 52.41517436,  13.71959516,  -0.93467424], [ 52.46183333,  13.65641729,  -0.98703412], [ 52.50512189,  13.59088406,  -1.03939399], [ 52.54492137,  13.5231751 ,  -1.09175387], [ 52.5811227 ,  13.45347599,  -1.14411375], [ 52.61362665,  13.38197776,  -1.19647363], [ 52.64234412,  13.3088764 ,  -1.2488335 ], [ 52.6671964 ,  13.23437226,  -1.30119338], [ 52.68811539,  13.15866956,  -1.35355326], [ 52.70504373,  13.08197579,  -1.40591314], [ 52.71793502,  13.00450117,  -1.45827302], [ 52.72675395,  12.92645804,  -1.51063289],[ 50.76821301,  10.24817497,   3.0089237 ],[ 50.47084929,  10.287859  ,   3.0089237 ],[ 50.17348558,  10.32754303,   3.0089237 ],[ 49.87612187,  10.36722707,   3.0089237 ],[ 49.57875816,  10.4069111 ,   3.0089237 ],[ 49.28139444,  10.44659513,   3.0089237 ],[ 48.98403073,  10.48627916,   3.0089237 ],[ 48.68666702,  10.52596319,   3.0089237 ],[ 48.38930331,  10.56564723,   3.0089237 ],[ 48.09193959,  10.60533126,   3.0089237 ],[ 47.79457588,  10.64501529,   3.0089237 ],[ 47.49721217,  10.68469932,   3.0089237 ],[ 47.19984846,  10.72438336,   3.0089237 ],[ 45.95263368,  10.64091811,   2.74908115],[ 45.67544829,  10.75567114,   2.74908115],[ 45.3982629 ,  10.87042418,   2.74908115],[ 45.12107751,  10.98517722,   2.74908115],[ 44.84389212,  11.09993026,   2.74908115],[ 44.56670673,  11.21468329,   2.74908115],[ 44.28952134,  11.32943633,   2.74908115],[ 44.01233595, 11.44418937 ,   2.74908115],[ 43.73515056,  11.55894241,   2.74908115],[ 43.45796518, 11.67369545 ,   2.74908115],[ 43.18077979, 11.78844848 ,   2.74908115],[ 42.9035944 ,  11.90320152,   2.74908115],[ 42.62640901,  12.01795456,   2.74908115],[ 42.34922362,  12.1327076 ,   2.74908115],[ 42.07203823,  12.24746063,   2.74908115],[ 41.79485284,  12.36221367,   2.74908115],[ 41.51766745,  12.47696671,   2.74908115],[ 41.24048206,  12.59171975,   2.74908115],[ 40.96329667,  12.70647279,   2.74908115],[ 40.68611128,  12.82122582,   2.74908115],[ 40.40892589,  12.93597886,   2.74908115],[ 40.1317405 ,  13.0507319 ,   2.74908115],[ 39.85455511,  13.16548494,   2.74908115],[ 39.57736972,  13.28023797,   2.74908115],[ 39.32925415,  13.41353989,   2.77289819],[ 39.25599232,  13.44184547,   2.72053831],[ 39.18431228,  13.4739465 ,   2.66817843],[ 39.11441052,  13.50975497,   2.61581855],[ 39.04647863,  13.54917275,   2.56345868],[ 38.98070281,  13.59209178,   2.5110988 ],[ 38.91726334,  13.63839444,   2.45873892],[ 38.8563341 ,  13.68795381,   2.40637904],[ 38.7980821 ,  13.74063404,   2.35401917],[ 38.742667  ,  13.79629076,   2.30165929],[ 38.6902407 ,  13.8547714 ,   2.24929941],[ 38.64094688,  13.91591567,   2.19693953],[ 38.59492067,  13.97955599,   2.14457966],[ 38.5522882 ,  14.04551792,   2.09221978],[ 38.52993275,  14.08443396,   2.0622997 ],[ 38.3883472 ,  14.34892126,   2.0622997 ],[ 38.24676165,  14.61340856,   2.0622997 ],[ 38.1051761 ,  14.87789586,   2.0622997 ],[ 37.96359055,  15.14238316,   2.0622997 ],[ 37.822005  ,  15.40687046,   2.0622997 ],[ 37.68041945,  15.67135776,   2.0622997 ],[ 37.5388339 ,  15.93584506,   2.0622997 ],[ 37.39724835,  16.20033236,   2.0622997 ],[ 37.2556628 ,  16.46481966,   2.0622997 ],[ 37.11407724,  16.72930696,   2.0622997 ],[ 34.74039194,  16.55764743,  -2.42709215],[ 34.51376575,  16.36107538,  -2.42709215],[ 34.28713956,  16.16450333,  -2.42709215],[ 34.06051338,  15.96793128,  -2.42709215],[ 33.83388719,  15.77135923,  -2.42709215],[ 33.607261  ,  15.57478718,  -2.42709215],[ 33.38063481,  15.37821513,  -2.42709215],[ 33.15400862,  15.18164308,  -2.42709215],[ 32.92738243,  14.98507104,  -2.42709215],[ 32.70075625,  14.78849899,  -2.42709215],[ 32.47413006,  14.59192694,  -2.42709215],[ 32.24750387,  14.39535489,  -2.42709215],[ 32.02087768,  14.19878284,  -2.42709215],[ 31.79425149,  13.00221079,  -2.42709215],[ 31.44891357,  12.61046314,  -2.98500525],[ 31.37133468,  12.59821499,  -3.03736513],[ 31.29322108,  12.5900438 ,  -3.089725  ],[ 31.21478688,  12.58597195,   3.14110043],[ 31.13624708,  12.58601061,   3.08874055],[ 31.05781693,  12.59015967,   3.03638067],[ 30.97971141,  12.59840776,   2.98402079],[ 30.90214461,  12.61073228,   2.93166092],[ 30.82532912,  12.62709944,   2.87930104],[ 30.7494755 ,  12.64746438,   2.82694116],[ 30.67479165,  12.67177128,   2.77458128],[ 30.60148228,  12.69995352,   2.72222141],[ 30.52974832,  12.73193385,   2.66986153],[ 30.45978639,  12.76762463,   2.61750165],[ 30.39178825,  12.80692801,   2.56514177],[ 30.33984342,  12.84069774,   2.52383716],[ 30.09528926,  13.01445983,   2.52383716],[ 29.85073509,  13.18822191,   2.52383716],[ 29.60618093,  13.36198399,   2.52383716],[ 29.36162677,  13.53574608,   2.52383716],[ 29.11707261,  13.70950816,   2.52383716],[ 28.87251845,  13.88327025,   2.52383716],[ 28.62796428,  14.05703233,   2.52383716],[ 28.38341012,  14.23079441,   2.52383716],[ 28.13885596,  14.4045565 ,   2.52383716],[ 27.8943018 ,  14.57831858,   2.52383716],[ 27.64974764,  14.75208067,   2.52383716],[ 27.40519347,  14.92584275,   2.52383716],[ 27.16063931,  15.09960483,   2.52383716],[ 26.91608515,  15.27336692,   2.52383716],[ 26.67153099,  15.447129  ,   2.52383716],[ 26.65355656,  15.4599003 ,   2.52383716],[ 26.58953243,  15.5053911 ,   2.57619703],[ 26.52321524,  15.5474688 ,   2.62855691],[ 26.45478676,  15.58601806,   2.68091679],[ 26.38443454,  15.62093322,   2.73327667],[ 26.31235142,  15.65211858,   2.78563654],[ 26.23873497,  15.67948866,   2.83799642],[ 26.16378698,  15.70296845,   2.8903563 ],[ 26.08771285,  15.72249358,   2.94271618],[ 26.01072112,  15.73801054,   2.99507605],[ 25.94450499,  15.74778233,   3.03969824],[ 25.75099373,  15.79964447,   2.95879579],[ 25.67376245,  15.81392148,   3.01115567],[ 25.59588982,  15.82413695,   3.06351554],[ 25.51758927,  15.83026289,   3.11587542],[ 25.43907543,  15.83228249,  -3.11495001],[ 25.36056349,  15.83019023,  -3.06259013],[ 25.33044084,  15.8278055 ,  -3.04244554],[ 25.03191416,  15.79811007,  -3.04244554],[ 24.73338747,  15.76841465,  -3.04244554],[ 24.43486079,  15.73871922,  -3.04244554],[ 24.1363341 ,  15.70902379,  -3.04244554],[ 23.83780742,  15.67932836,  -3.04244554],[ 23.53928073,  15.64963294,  -3.04244554],[ 23.24075405,  15.61993751,  -3.04244554],[ 22.94222736,  15.59024208,  -3.04244554],[ 22.64370068,  15.56054666,  -3.04244554],[ 22.34517399,  15.53085123,  -3.04244554],[ 22.04664731,  15.5011558 ,  -3.04244554],[ 21.74812062,  15.47146037,  -3.04244554],[ 21.44959394,  15.44176495,  -3.04244554],[ 21.15106726,  15.41206952,  -3.04244554],[ 20.9437132 ,  15.39144333,  -3.04244554],[ 20.8655591 ,  15.38366909,  -2.99008566],[ 20.78791898,  15.37181523,  -2.93772578],[ 20.71100564,  15.35591424,  -2.8853659 ],[ 20.6350299 ,  15.33600972,  -2.83300603],[ 20.59835934,  15.32432025,  -2.80734695],[ 20.31708908,  15.27335548,  -2.69121016],[ 20.2463812 ,  15.23916632,  -2.63885029],[ 20.31133386,  15.27488175,  -2.68826661],[ 20.04163523,  15.14349434,  -2.68826661],[ 19.77193661,  15.01210692,  -2.68826661],[ 19.50223799,  14.88071951,  -2.68826661],[ 19.23253937,  14.74933209,  -2.68826661],[ 18.96284074,  14.61794468,  -2.68826661],[ 18.69314212,  14.48655726, -2.68826661],[ 18.4234435 ,  14.35516985,  -2.68826661],[ 18.15374487,  14.22378243,  -2.68826661],[ 17.88404625,  14.09239502,  -2.68826661],[ 17.61434763,  13.96100761,  -2.68826661],[ 17.344649  ,  13.82962019,  -2.68826661],[ 17.07495038,  13.69823278,  -2.68826661],[ 16.80525176,  13.56684536,  -2.68826661],[ 16.53555314,  13.43545795,  -2.68826661],[ 16.26585451,  13.30407053,  -2.68826661],[ 15.99615589,  13.17268312,  -2.68826661],[ 15.72645727,  13.0412957 ,  -2.68826661],[ 15.45675864,  12.90990829,  -2.68826661],[ 15.18706002,  12.77852087,  -2.68826661],[ 14.9173614 ,  12.64713346,  -2.68826661],[ 14.64766277,  12.51574604,  -2.68826661],[ 14.37796415,  12.38435863,  -2.68826661],[ 14.10826553,  12.25297121,  -2.68826661],[ 13.83856691,  12.1215838 ,  -2.68826661],[ 13.56886828,  11.99019638,  -2.68826661],[ 13.41778022,  11.91659174,  -2.68826661],[ 13.34717328,  11.8821946 ,  -2.63590673],[ 13.27846332,  11.84414931,  -2.58354685],[ 13.21183866,  11.80256016,  -2.53118698],[ 13.14748191,  11.75754115,  -2.4788271 ],[ 13.098574  ,  11.71936628,  -2.43746526],[ 12.82726479,  11.43290901,  -2.0427078 ],[ 12.7915614 ,  11.36295352,  -2.09506768],[ 12.75579136,  11.30109411,  -2.14270558],[ 12.59341982,  11.04883337,  -2.14270558],[ 12.43104828,  10.79657263,  -2.14270558],[ 12.26867673,  10.54431188,  -2.14270558],[ 12.10630519,  10.29205114,  -2.14270558],[ 11.94393365,  10.0397904 ,  -2.14270558],[ 11.78156211,   9.78752965,  -2.14270558],[ 11.61919057,   9.53526891,  -2.14270558],[ 11.45681903,   9.28300817,  -2.14270558],[ 11.29444749,   9.03074742,  -2.14270558],[ 11.13207595,   8.77848668,  -2.14270558],[ 10.96970441,   8.52622593,  -2.14270558],[ 10.80733287,   8.27396519,  -2.14270558],[ 10.69051054,   8.09246979,  -2.14270558],[ 10.64800177,   8.02642808,  -2.09034571],[ 10.65366464,   8.03632884,  -2.0979496 ]]

  def viz_sub(self, msg):

    pa = PoseArray()
    pa.header.frame_id = '/map'
    pa.header.stamp = rospy.Time.now()

    map_img, self.map_info = utils.get_map(MAP_TOPIC) # Get and store the map
    plan_array = []     
    map_pose = []      
                 
    for k in xrange(len(self.plan1)):
         temp_xy = self.plan1[k]
         ori = Pose()
         #Setup the pose
         pose_out = Pose()
         pose_out.position.x = temp_xy[0]
         pose_out.position.y = temp_xy[1]
         pose_out.position.z = 0
         pose_out.orientation = utils.angle_to_quaternion(temp_xy[2])

         #Append the pose onto the array
         pa.poses.append(pose_out)
         #print(pose_out)

    self.pub.publish(pa)
         
if __name__ == '__main__':
  
  rospy.init_node('point_map', anonymous=True) # Initialize the node
  
  pm = PointMap() # Create a clone follower
  rospy.spin() # Spin
